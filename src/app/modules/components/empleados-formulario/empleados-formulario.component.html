<div class="empleados-formulario">
  <div class="page-header mb-4">
    <h2 class="mb-2">
      <i class="bi bi-calendar-week me-3"></i>
      Calendario de Empleados
    </h2>
    <p class="text-muted mb-0">Gestiona los horarios, n√≥minas y registros de trabajo de los empleados</p>
  </div>

  <!-- Formulario para agregar n√≥mina -->
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">
        <i class="bi bi-calendar-plus me-2"></i>
        Registrar N√≥mina
      </h5>
    </div>
    <div class="card-body">
      <form (ngSubmit)="agregarNomina()" class="row g-4">
        <!-- Primera fila: Fecha y Empleado -->
        <div class="col-lg-6">
          <mat-form-field class="w-100">
            <mat-label>
              <i class="bi bi-calendar-range me-1"></i>
              Rango de fechas
            </mat-label>
            <mat-date-range-input [rangePicker]="picker">
              <input matStartDate placeholder="Fecha inicio" [(ngModel)]="fechaRango.inicio" name="fechaInicio">
              <input matEndDate placeholder="Fecha fin" [(ngModel)]="fechaRango.fin" name="fechaFin">
            </mat-date-range-input>
            <mat-hint>MM/DD/YYYY ‚Äì MM/DD/YYYY</mat-hint>
            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-date-range-picker #picker></mat-date-range-picker>
          </mat-form-field>
        </div>

        <div class="col-lg-6">
          <div class="form-group">
            <label for="empleadoNomina" class="form-label fw-bold">
              <i class="bi bi-person-badge me-1"></i>
              Empleado *
            </label>
            <select
              class="form-select form-select-lg"
              id="empleadoNomina"
              [(ngModel)]="nuevoRegistroNomina.empleado"
              name="empleadoNomina"
              required>
              <option value="">Seleccionar empleado</option>
              <option *ngFor="let empleado of empleados" [value]="empleado">
                {{ empleado }}
              </option>
            </select>
          </div>
        </div>

        <!-- Segunda fila: Monto y Observaciones -->
        <div class="col-lg-6">
          <div class="form-group">
            <label for="monto" class="form-label fw-bold">
              <i class="bi bi-currency-dollar me-1"></i>
              Monto (opcional)
            </label>
            <div class="input-group">
              <span class="input-group-text">$</span>
              <input
                type="number"
                class="form-control form-control-lg"
                id="monto"
                [(ngModel)]="nuevoRegistroNomina.monto"
                name="monto"
                placeholder="0.00"
                step="0.01"
                min="0">
            </div>
          </div>
        </div>

        <div class="col-lg-6">
          <div class="form-group">
            <label for="observaciones" class="form-label fw-bold">
              <i class="bi bi-chat-text me-1"></i>
              Observaciones
            </label>
            <input
              type="text"
              class="form-control form-control-lg"
              id="observaciones"
              [(ngModel)]="nuevoRegistroNomina.observaciones"
              name="observaciones"
              placeholder="Observaciones adicionales">
          </div>
        </div>

        <!-- Tercera fila: Bot√≥n de env√≠o -->
        <div class="col-12">
          <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-warning btn-lg px-4">
              <i class="bi bi-check-circle me-2"></i>
              Registrar N√≥mina
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- Calendarios por empleado -->
  <div class="calendarios-empleados">
    <div class="row">
      <div *ngFor="let empleado of empleados" class="col-md-4 mb-3">
        <div class="calendario-empleado">
          <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
              <div class="empleado-info">
                <h5 class="mb-1">{{ empleado }}</h5>
                <small class="text-muted">
                  <span *ngIf="isSoloNomina(empleado)">
                    Solo registra n√≥mina | Fechas: {{ getFechasNominaTexto(empleado) }}
                  </span>
                  <span *ngIf="!isSoloNomina(empleado)">
                    D√≠as laborales: {{ getDiasLaboralesTexto(empleado) }} |
                    N√≥mina: {{ getFechasNominaTexto(empleado) }}
                    <span *ngIf="getTurnoPredeterminado(empleado)"> | Turno: {{ getTurnoPredeterminado(empleado) }}</span>
                  </span>
                </small>
                <!-- Resumen del mes -->
                <div class="resumen-mes mt-2" *ngIf="!isSoloNomina(empleado)">
                  <small class="text-white">
                    <span class="badge bg-primary me-2">
                      <i class="bi bi-calendar-check me-1"></i>
                      {{ getDiasTrabajadosMes(empleado) }} d√≠as
                    </span>
                    <span class="badge bg-success me-2">
                      <i class="bi bi-cash me-1"></i>
                      {{ getDiasPagadosMes(empleado) }} pagados
                    </span>
                    <span class="badge bg-warning me-2">
                      <i class="bi bi-currency-dollar me-1"></i>
                      ${{ getTotalPagosMes(empleado) | number:'1.0-0' }}
                    </span>
                    <button
                      *ngIf="getDiasPendientesPago(empleado) > 0"
                      class="btn btn-sm btn-outline-light"
                      (click)="pagarDiasPendientes(empleado)"
                      title="Pagar d√≠as pendientes">
                      <i class="bi bi-cash-stack me-1"></i>
                      Pagar {{ getDiasPendientesPago(empleado) }}
                    </button>
                  </small>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div class="controles-calendario mb-3">
                <button class="btn btn-sm btn-outline-secondary" (click)="cambiarMes(-1)">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <span class="mx-2">{{ getNombreMes() }} {{ currentYear }}</span>
                <button class="btn btn-sm btn-outline-secondary" (click)="cambiarMes(1)">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
              <div class="calendario">
                <!-- Encabezados de d√≠as de la semana -->
                <div class="calendario-header">
                  <div class="dia-header" *ngFor="let dia of ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b']">
                    {{ dia }}
                  </div>
                </div>

                <!-- D√≠as del mes -->
                <div class="calendario-body">
                  <div
                    class="dia-calendario"
                    *ngFor="let fecha of getDiasDelMes()"
                    [class]="getClaseDia(fecha, empleado)"
                    [class.clickeable]="esDiaClickeable(fecha, empleado)"
                    (click)="fecha && seleccionarDia(fecha, empleado)">
                    <div class="numero-dia" *ngIf="fecha">{{ fecha.getDate() }}</div>
                    <div class="info-dia" *ngIf="fecha">
                      <!-- Para empleados que solo registran n√≥mina (Saul) -->
                      <small class="nomina-recibida" *ngIf="isSoloNomina(empleado) && isNominaPagada(fecha, empleado)">üí∞</small>
                      <small class="nomina-pendiente" *ngIf="isSoloNomina(empleado) && isFechaNomina(fecha, empleado) && !isNominaPagada(fecha, empleado)">$</small>

                      <!-- Para empleados que trabajan (Farzin y Evelyn) -->
                      <small class="turno" *ngIf="!isSoloNomina(empleado) && isDiaTrabajado(fecha, empleado)">
                        {{ isDiaTrabajado(fecha, empleado)?.turno === 'Noche' ? 'üåô' : '‚òÄÔ∏è' }}
                      </small>
                      <small class="pago" *ngIf="!isSoloNomina(empleado) && isDiaTrabajado(fecha, empleado)?.pago">üíµ</small>
                      <small class="nomina" *ngIf="!isSoloNomina(empleado) && isFechaNomina(fecha, empleado)">üìã</small>

                      <!-- N√≥mina pagada para todos los empleados -->
                      <small class="nomina-recibida" *ngIf="!isSoloNomina(empleado) && isNominaPagada(fecha, empleado)">üí∞</small>

                      <!-- N√≥mina registrada pero pendiente de pago -->
                      <small class="nomina-pendiente" *ngIf="!isSoloNomina(empleado) && isNominaRecibida(fecha, empleado) && !isNominaPagada(fecha, empleado)">üìã</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


</div>

<!-- Modal unificado -->
<app-confirmacion-modal
  [mostrar]="modalActual.mostrar"
  [datos]="modalActual.datos"
  (confirmar)="onModalConfirmar()"
  (cancelar)="onModalCancelar()"
  (cerrar)="onModalCerrar()">
</app-confirmacion-modal>
