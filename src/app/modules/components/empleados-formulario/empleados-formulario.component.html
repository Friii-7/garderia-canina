<div class="empleados-formulario">
  <h2 class="mb-4">Calendario de Empleados</h2>



  <!-- Formulario para agregar nÃ³mina -->
  <div class="card mb-4">
    <div class="card-header">
      <h5>Registrar NÃ³mina</h5>
    </div>
    <div class="card-body">
      <form (ngSubmit)="agregarNomina()" class="row g-3">
        <div class="col-md-3">
          <label for="fechaInicio" class="form-label">Fecha inicio *</label>
          <input
            type="date"
            class="form-control"
            id="fechaInicio"
            [(ngModel)]="nuevoRegistroNomina.fechaInicio"
            name="fechaInicio"
            required>
        </div>

        <div class="col-md-3">
          <label for="fechaFin" class="form-label">Fecha fin *</label>
          <input
            type="date"
            class="form-control"
            id="fechaFin"
            [(ngModel)]="nuevoRegistroNomina.fechaFin"
            name="fechaFin"
            required>
        </div>

        <div class="col-md-3">
          <label for="empleadoNomina" class="form-label">Empleado</label>
          <select
            class="form-select"
            id="empleadoNomina"
            [(ngModel)]="nuevoRegistroNomina.empleado"
            name="empleadoNomina"
            required>
            <option value="">Seleccionar empleado</option>
            <option *ngFor="let empleado of empleados" [value]="empleado">
              {{ empleado }}
            </option>
          </select>
        </div>

        <div class="col-md-3">
          <label for="monto" class="form-label">Monto (opcional)</label>
          <input
            type="number"
            class="form-control"
            id="monto"
            [(ngModel)]="nuevoRegistroNomina.monto"
            name="monto"
            placeholder="0">
        </div>

        <div class="col-md-3">
          <label for="observaciones" class="form-label">Observaciones</label>
          <input
            type="text"
            class="form-control"
            id="observaciones"
            [(ngModel)]="nuevoRegistroNomina.observaciones"
            name="observaciones"
            placeholder="Observaciones">
        </div>

        <div class="col-12">
          <button type="submit" class="btn btn-warning">Registrar NÃ³mina</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Calendarios por empleado -->
  <div class="calendarios-empleados">
    <div *ngFor="let empleado of empleados" class="calendario-empleado mb-4">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <div class="empleado-info">
            <h4>{{ empleado }}</h4>
                                    <small class="text-muted">
              <span *ngIf="isSoloNomina(empleado)">
                Solo registra nÃ³mina | Fechas: {{ getFechasNominaTexto(empleado) }}
              </span>
              <span *ngIf="!isSoloNomina(empleado)">
                DÃ­as laborales: {{ getDiasLaboralesTexto(empleado) }} |
                NÃ³mina: {{ getFechasNominaTexto(empleado) }}
                <span *ngIf="getTurnoPredeterminado(empleado)"> | Turno: {{ getTurnoPredeterminado(empleado) }}</span>
              </span>
            </small>
          </div>
          <div class="controles-calendario">
            <button class="btn btn-sm btn-outline-secondary" (click)="cambiarMes(-1)">
              <i class="fas fa-chevron-left"></i> Anterior
            </button>
            <span class="mx-3">{{ getNombreMes() }} {{ currentYear }}</span>
            <button class="btn btn-sm btn-outline-secondary" (click)="cambiarMes(1)">
              Siguiente <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
        <div class="card-body">
          <div class="calendario">
            <!-- Encabezados de dÃ­as de la semana -->
            <div class="calendario-header">
              <div class="dia-header" *ngFor="let dia of ['Dom', 'Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b']">
                {{ dia }}
              </div>
            </div>

                        <!-- DÃ­as del mes -->
            <div class="calendario-body">
                            <div
                class="dia-calendario"
                *ngFor="let fecha of getDiasDelMes()"
                [class]="getClaseDia(fecha, empleado)"
                [title]="getTooltipDia(fecha, empleado)">
                <div class="numero-dia" *ngIf="fecha">{{ fecha.getDate() }}</div>
                                <div class="info-dia" *ngIf="fecha">
                  <!-- Para empleados que solo registran nÃ³mina (Saul) -->
                  <small class="nomina-recibida" *ngIf="isSoloNomina(empleado) && isNominaPagada(fecha, empleado)">âœ“</small>
                  <small class="nomina-pendiente" *ngIf="isSoloNomina(empleado) && isFechaNomina(fecha, empleado) && !isNominaPagada(fecha, empleado)">$</small>

                  <!-- Para empleados que trabajan (Farzin y Evelyn) -->
                  <small class="turno" *ngIf="!isSoloNomina(empleado) && isDiaTrabajado(fecha, empleado)">
                    {{ isDiaTrabajado(fecha, empleado)?.turno }}
                  </small>
                  <small class="pago" *ngIf="!isSoloNomina(empleado) && isDiaTrabajado(fecha, empleado)?.pago">âœ“</small>
                  <small class="nomina" *ngIf="!isSoloNomina(empleado) && isFechaNomina(fecha, empleado)">$</small>

                  <!-- NÃ³mina pagada para todos los empleados -->
                  <small class="nomina-recibida" *ngIf="!isSoloNomina(empleado) && isNominaPagada(fecha, empleado)">ðŸ’°</small>

                  <!-- NÃ³mina registrada pero pendiente de pago -->
                  <small class="nomina-pendiente" *ngIf="!isSoloNomina(empleado) && isNominaRecibida(fecha, empleado) && !isNominaPagada(fecha, empleado)">$</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Leyenda -->
  <div class="card mt-4">
    <div class="card-header">
      <h5>Leyenda</h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-3">
          <div class="leyenda-item">
            <span class="indicador dia-trabajado"></span>
            <span>DÃ­a trabajado (Turno dÃ­a)</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="leyenda-item">
            <span class="indicador dia-trabajado turno-noche"></span>
            <span>DÃ­a trabajado (Turno noche)</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="leyenda-item">
            <span class="indicador dia-laboral"></span>
            <span>DÃ­a laboral (no registrado)</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="leyenda-item">
            <span class="indicador fecha-nomina"></span>
            <span>Fecha de nÃ³mina</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="leyenda-item">
            <span class="indicador dia-festivo"></span>
            <span>DÃ­a festivo</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="leyenda-item">
            <span class="indicador nomina-recibida"></span>
            <span>NÃ³mina recibida (Saul)</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="leyenda-item">
            <span>ðŸ’°</span>
            <span>NÃ³mina pagada (Farzin/Evelyn)</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="leyenda-item">
            <span>$</span>
            <span>NÃ³mina registrada (pendiente)</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="leyenda-item">
            <span class="indicador fecha-nomina-pendiente"></span>
            <span>Fecha nÃ³mina (pendiente)</span>
          </div>
        </div>
        <div class="col-md-3">
          <div class="leyenda-item">
            <span class="indicador pago-realizado"></span>
            <span>Pago realizado</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de confirmaciÃ³n -->
<app-confirmacion-modal
  [mostrar]="mostrarModal"
  [datos]="datosModal"
  (confirmar)="confirmarAgregarNomina()"
  (cancelar)="cancelarAgregarNomina()"
  (cerrar)="cancelarAgregarNomina()">
</app-confirmacion-modal>
