<!-- Botón para modal -->
<button
  class="btn btn-secondary mb-3"
  (click)="abrirModal(obtenerUltimoRegistro()!)"
  [disabled]="registros.length === 0">
  Ver último registro / PDF
</button>

<!-- Tabla de registros -->
<div class="card shadow-sm">
  <div class="card-body">
    <h5 class="card-title mb-3">Registros</h5>
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Fecha ingreso</th>
            <th>Tamaño</th>
            <th>Días alojamiento</th>
            <th>Di sol</th>
            <th>Baño</th>
            <th>Ingresos</th>
            <th>Gastos</th>
            <th>Total</th>
            <th>Método de pago</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let registro of registros; let i = index">
            <td>{{ registro.nombre }}</td>
            <td>{{ registro.fecha }}</td>
            <td>{{ registro.tamano }}</td>
            <td>{{ registro.dias }}</td>
            <td>{{ registro.diSol ? 'Sí' : 'No' }}</td>
            <td>{{ registro.bano ? 'Sí' : 'No' }}</td>
            <td>${{ registro.ingresos.toLocaleString() }}</td>
            <td>${{ registro.gastos.toLocaleString() }}</td>
            <td>${{ registro.total.toLocaleString() }}</td>
            <td>{{ registro.metodoPago }}</td>
            <td>
              <div class="btn-group" role="group">
                <button
                  class="btn btn-sm btn-outline-info me-1"
                  title="Ver detalles"
                  (click)="abrirModal(registro)">
                  <i class="bi bi-eye"></i>
                </button>
                <button
                  class="btn btn-sm btn-outline-warning me-1"
                  title="Editar registro"
                  (click)="editarRegistro(registro)">
                  <i class="bi bi-pencil"></i>
                </button>
                <button
                  class="btn btn-sm btn-outline-danger"
                  title="Eliminar registro"
                  (click)="eliminarRegistro(registro)">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Modal -->
<div
  class="modal fade"
  [class.show]="mostrarModal"
  [style.display]="mostrarModal ? 'block' : 'none'"
  tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalle de mascota</h5>
        <button
          type="button"
          class="btn-close"
          (click)="cerrarModal()">
        </button>
      </div>
      <div class="modal-body" *ngIf="registroSeleccionado">
        <p><strong>Nombre:</strong> {{ registroSeleccionado.nombre }}</p>
        <p><strong>Fecha ingreso:</strong> {{ registroSeleccionado.fecha }}</p>
        <p><strong>Tamaño:</strong> {{ registroSeleccionado.tamano }}</p>
        <p><strong>Días alojamiento:</strong> {{ registroSeleccionado.dias }}</p>
        <p><strong>Di sol:</strong> {{ registroSeleccionado.diSol ? 'Sí' : 'No' }}</p>
        <p><strong>Baño:</strong> {{ registroSeleccionado.bano ? 'Sí' : 'No' }}</p>
        <p><strong>Ingresos:</strong> ${{ registroSeleccionado.ingresos.toLocaleString() }}</p>
        <p><strong>Gastos:</strong> ${{ registroSeleccionado.gastos.toLocaleString() }}</p>
        <p><strong>Total:</strong> ${{ registroSeleccionado.total.toLocaleString() }}</p>
        <p><strong>Método de pago:</strong> {{ registroSeleccionado.metodoPago }}</p>
      </div>
      <div class="modal-footer">
        <button
          class="btn btn-primary"
          (click)="generarPDF()">
          Generar PDF
        </button>
        <button
          class="btn btn-secondary"
          (click)="cerrarModal()">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop del modal -->
<div
  class="modal-backdrop fade show"
  *ngIf="mostrarModal"
  (click)="cerrarModal()">
</div>

<!-- Modal de Edición -->
<div
  class="modal fade"
  [class.show]="mostrarModalEdicion"
  [style.display]="mostrarModalEdicion ? 'block' : 'none'"
  tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar Registro - {{ nombreMascotaEdit }}</h5>
        <button
          type="button"
          class="btn-close"
          (click)="cerrarModalEdicion()">
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="nombreEdit" class="form-label">Nombre de la mascota *</label>
              <input
                type="text"
                class="form-control"
                id="nombreEdit"
                [(ngModel)]="nombreMascotaEdit"
                name="nombreEdit"
                required>
            </div>
            <div class="col-md-6 mb-3">
              <label for="fechaEdit" class="form-label">Fecha de ingreso *</label>
              <input
                type="date"
                class="form-control"
                id="fechaEdit"
                [(ngModel)]="fechaIngresoEdit"
                name="fechaEdit"
                required>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="tamanoEdit" class="form-label">Tamaño del perro *</label>
              <select
                class="form-select"
                id="tamanoEdit"
                [(ngModel)]="tamanoPerroEdit"
                name="tamanoEdit"
                (change)="actualizarIngresosEdit()"
                required>
                <option value="">Seleccione el tamaño</option>
                <option *ngFor="let opcion of opcionesTamano" [value]="opcion.valor">
                  {{ opcion.texto }}
                </option>
              </select>
            </div>
            <div class="col-md-6 mb-3">
              <label for="diasEdit" class="form-label">Días de alojamiento</label>
              <input
                type="number"
                class="form-control"
                id="diasEdit"
                [(ngModel)]="diasAlojamientoEdit"
                name="diasEdit"
                min="0"
                (input)="actualizarIngresosEdit()">
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="diSolEdit"
                  [(ngModel)]="servicioDiSolEdit"
                  name="diSolEdit"
                  (change)="actualizarIngresosEdit()">
                <label class="form-check-label" for="diSolEdit">
                  Servicio Di Sol (${{ tarifaDiSol.toLocaleString() }})
                </label>
              </div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="banoEdit"
                  [(ngModel)]="servicioBanoEdit"
                  name="banoEdit"
                  (change)="actualizarIngresosEdit()">
                <label class="form-check-label" for="banoEdit">
                  Servicio de Baño (${{ tarifaBano.toLocaleString() }})
                </label>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-4 mb-3">
              <label for="gastosEdit" class="form-label">Gastos adicionales</label>
              <input
                type="number"
                class="form-control"
                id="gastosEdit"
                [(ngModel)]="gastosEdit"
                name="gastosEdit"
                min="0"
                (input)="calcularTotalEdit()">
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Ingresos calculados</label>
              <div class="form-control-plaintext">
                ${{ ingresosEdit.toLocaleString() }}
              </div>
            </div>
            <div class="col-md-4 mb-3">
              <label class="form-label">Total</label>
              <div class="form-control-plaintext fw-bold">
                ${{ totalEdit.toLocaleString() }}
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="metodoPagoEdit" class="form-label">Método de pago *</label>
              <select
                class="form-select"
                id="metodoPagoEdit"
                [(ngModel)]="metodoPagoEdit"
                name="metodoPagoEdit"
                required>
                <option value="">Seleccione método de pago</option>
                <option *ngFor="let opcion of opcionesMetodoPago" [value]="opcion.valor">
                  {{ opcion.texto }}
                </option>
              </select>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          class="btn btn-primary"
          (click)="guardarEdicion()">
          <i class="bi bi-check-circle"></i> Guardar Cambios
        </button>
        <button
          class="btn btn-secondary"
          (click)="cerrarModalEdicion()">
          <i class="bi bi-x-circle"></i> Cancelar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Backdrop del modal de edición -->
<div
  class="modal-backdrop fade show"
  *ngIf="mostrarModalEdicion"
  (click)="cerrarModalEdicion()">
</div>
